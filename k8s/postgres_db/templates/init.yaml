apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Chart.Name }}-init"
  namespace: {{ .Values.namespace }}
data:
  init.sql: |
    CREATE ROLE {{ .Values.pg.primary.user }} WITH PASSWORD {{ .Values.pg.primary.password }};
    ALTER ROLE {{ .Values.pg.primary.user }} WITH LOGIN;
    
    CREATE DATABASE loyalties;
    GRANT ALL PRIVILEGES ON DATABASE payments TO {{ .Values.pg.primary.user }};

    CREATE DATABASE reservations;
    GRANT ALL PRIVILEGES ON DATABASE reservations TO {{ .Values.pg.primary.user }};

    CREATE DATABASE payments;
    GRANT ALL PRIVILEGES ON DATABASE loyalties TO {{ .Values.pg.primary.user }};